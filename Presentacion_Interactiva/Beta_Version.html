<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brazo Virtual</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background-color: black; }
        canvas { display: block; }
        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(220, 220, 220, 0.9);
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <h1>Control de Servos</h1>

    <script>
        function updateServo(value, type) {
            fetch('/move_' + type + '?angle=' + value);
        }
    </script>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        renderer.setClearColor(0x000000);

        // Materiales con propiedades de emisión para una mayor iluminación
        const armMaterial = new THREE.MeshStandardMaterial({ 
            color: 0xFF6347,  // Naranja brillante
            metalness: 0.8, 
            roughness: 0.3,
            emissive: 0xFF4500,  // Añadir emisión para brillo extra
            emissiveIntensity: 0.6
        });

        const elbowMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x87CEEB,  // Azul cielo claro
            metalness: 0.9, 
            roughness: 0.2,
            emissive: 0x4682B4,  // Emisión azul para mayor iluminación
            emissiveIntensity: 0.5
        });

        const magnetMaterial = new THREE.MeshStandardMaterial({
            color: 0xEAEAEA, // Color blanquecino
            metalness: 1.0, // Alto nivel de metalicidad para más brillo
            roughness: 0.1, // Menor rugosidad para mayor reflejo
            emissive: 0xFFFFFF, // Emisión blanca para mayor iluminación
            emissiveIntensity: 0.8 // Aumentar la intensidad de emisión
        });

        // Base rediseñada como un hexágono
        const baseGeometry = new THREE.CylinderGeometry(3, 3, 0.5, 6); // 6 segmentos para hexágono
        const baseMaterial = new THREE.MeshStandardMaterial({ 
            color: 0xFFFF00,  // Amarillo brillante
            metalness: 0.9, 
            roughness: 0.2
        });
        const base = new THREE.Mesh(baseGeometry, baseMaterial);
        base.position.y = -0.25;
        scene.add(base);

        const shoulder = new THREE.Group();

        // Brazo como un rectángulo
        const arm = new THREE.Mesh(new THREE.BoxGeometry(1, 4, 1), armMaterial);
        arm.position.y = 2;
        shoulder.add(arm);

        // Nexo circular entre el hombro y el brazo
        const shoulderJoint = new THREE.Mesh(new THREE.SphereGeometry(0.80, 32, 32), elbowMaterial);
        shoulderJoint.position.y = 4; // Posición en el hombro
        shoulder.add(shoulderJoint);

        // Codo como rectángulo
        const elbow = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), elbowMaterial);
        elbow.position.set(0, 4, 0);
        shoulder.add(elbow);

        // Antebrazo como un rectángulo
        const forearm = new THREE.Mesh(new THREE.BoxGeometry(1, 4, 1), armMaterial);
        forearm.position.set(0, 2, 0);
        elbow.add(forearm);

        // Electroimán en forma de dodecaedro al final del brazo
        const magnetGeometry = new THREE.DodecahedronGeometry(0.80); // Tamaño del dodecaedro
        const magnet = new THREE.Mesh(magnetGeometry, magnetMaterial);
        magnet.position.set(0, 2.7, 0); // Ajustar para que esté justo al lado del antebrazo
        forearm.add(magnet);

        scene.add(shoulder);
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 3, 0);

        // Luces intensificadas para mayor brillo
        const ambientLight = new THREE.AmbientLight(0x404040, 1.5); // Intensidad aumentada
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 3); // Luz más intensa
        pointLight.position.set(10, 10, 10);
        scene.add(pointLight);

        const pointLight2 = new THREE.PointLight(0xffffff, 1.5);
        pointLight2.position.set(-10, 10, -10);
        scene.add(pointLight2);

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        animate();

        // Controles de los sliders
        const controlContainer = document.createElement('div');
        controlContainer.className = 'controls';
        document.body.appendChild(controlContainer);

        const shoulderSlider = document.createElement('input');
        shoulderSlider.type = 'range';
        shoulderSlider.min = -90;
        shoulderSlider.max = 90;
        shoulderSlider.step = 1;
        shoulderSlider.value = -90;
        shoulder.rotation.z = THREE.MathUtils.degToRad(90);

        shoulderSlider.oninput = function() {
            const angle = parseFloat(this.value);
            shoulder.rotation.z = THREE.MathUtils.degToRad(-angle);
            updateServo(angle, 'hombro');
        };

        const elbowSlider = document.createElement('input');
        elbowSlider.type = 'range';
        elbowSlider.min = 90;
        elbowSlider.max = 180;
        elbowSlider.step = 1;
        elbowSlider.value = 0;
        elbow.rotation.z = THREE.MathUtils.degToRad(270);

        elbowSlider.oninput = function() {
            const angle = parseFloat(this.value);
            elbow.rotation.z = THREE.MathUtils.degToRad(-angle);
            updateServo(angle, 'codo');
        };

        controlContainer.appendChild(document.createTextNode('Hombro (0 a 180°): '));
        controlContainer.appendChild(shoulderSlider);

        controlContainer.appendChild(document.createElement('br'));
        controlContainer.appendChild(document.createTextNode('Codo (0 a 180°): '));
        controlContainer.appendChild(elbowSlider);
    </script>
</body>
</html>
